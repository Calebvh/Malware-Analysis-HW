#include <stdio.h>
#include <string.h>

/*void obfuscate(int param_1,uint param_2)

{
  uint local_c;
  uint local_8;
  
  local_c = 0x1f2f3f4f;
  if (param_2 < 0x101) {
    local_8 = 0;
    while (local_8 < param_2) {
      local_c = (int)*(char *)(param_1 + local_8) * (local_c >> 3) * (local_8 + 1);
      *(undefined *)(param_1 + local_8) = (char)local_c;
      local_8 = local_8 + 1;
    }
  }
  return;
}*/
void obfuscate(char* flag, int flag_len){
  long int local_c = 0x1f2f3f4f;
  int i =0;
  for(i; i<flag_len; i++){
    printf("%c --->", flag[i]);
    local_c = flag[i] * (local_c >> 3) * (i+1);
    printf("%02lx \n", local_c);
    flag[i] = local_c & 0xff; 
  }
  //printf("%li\n", local_c);
  //printf("%i\n", flag[0]);
}

int findIndex(char* str, char tofind){
  char* ptr;
  int index;
  ptr = strchr(str, tofind);
  if(ptr==NULL){
    printf("Character not found");
    return 0;
  }
  index = ptr - str;
  //printf("index is: %d\n", index);
  return index;
}


char checker[35] = {0xD6, 0xF0, 0xBA, 0x04, 0x40, 0x90, 0x32, 0x30, 0x18, 0x18, 0xC3, 0x80, 0x80,
                    0xE0, 0xD8, 0x20, 0x2C, 0x02, 0xA0, 0x20, 0x2C, 0x7C, 0x49, 0xB8, 0xD0, 0xE0, 
                    0x7C, 0x98, 0x6C, 0x56, 0x84, 0x00, 0x00, 0x00, 0x80};//, 0xC0, 0x00 };

char charBank[17] = {'a', 'b', 'c', 'd', 'e', 'f','}',
'0','1','2','3','4','5','6','7','8','9'};

int foundone = 0;

void main(int argc, char const *argv[])
{

  int visited[35][20] = {0};
  char flag[35] = {'f', 'l', 'a', 'g','{','7','7','1','d','4','c','4','8','c','6','6','3','e','a','\x00'};
  char flag_temp[35];
  int flag_end = 19;
  int helper;
  int prev_char = -1;
  int count = 0;

  obfuscate(flag, strlen(flag));
  printf("%02x", flag[17]);


/*
  while(flag_end <= 35){
    helper = flag_end;
    int i = 0;
    for(i; i<17; i++){
      memset(flag_temp,0, 35);
      strncpy(flag_temp,flag,flag_end);
      flag_temp[flag_end] = charBank[i];

      //if(flag_end > 17){
      printf("Char: %s --:", flag_temp);
      //}
      
      obfuscate(flag_temp, flag_end+1);
      
      //if(flag_end > 17){
        printf("New char: %02x -> %02x\n", flag_temp[flag_end], checker[flag_end]);
      //}
      //printf("%s\n", flag_temp);
      if(flag_temp[flag_end] == checker[flag_end] && prev_char<i){
        printf("Found a character: %c\n", charBank[i]);
        prev_char = -1;
        flag[flag_end] = charBank[i];
        visited[flag_end][i] = 0;
        flag_end++;

        break;
      }
    }
    if(flag_end == helper){
      printf("Wrong character found: going back...\n");
      prev_char = findIndex(charBank, flag[flag_end-1]);
      flag[flag_end-1] = 0;
      flag_end= flag_end-1;

      printf("prev char: %c\n", charBank[prev_char]);
      printf("%s     ", flag);
      printf("Flag End: %i\n", flag_end);
    }
    
    if(flag[3] != 'g' || flag[4] == '7'){
      printf("Flag not found");
      break;
    }

  }
  */

  //printf("%s\n", flag);
  //printf("%02x\n", flag_temp[5]);
  //int n = sizeof(flag)/sizeof(flag[0]);
  //printf("%i", n);
}







